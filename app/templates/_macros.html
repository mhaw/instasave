{% macro display_flash_messages(messages) %}
    {% if messages %}
        <div class="flash-messages">
            {% for message in messages %}
                <div class="alert alert-{{ message.category }}">{{ message.message }}</div>
            {% endfor %}
        </div>
    {% endif %}
{% endmacro %}

{% macro render_post_card(post) %}
    <div class="post-card">
        <h3><a href="{{ post.url }}" target="_blank">{{ post.caption[:50] }}...</a></h3>
        <p class="timestamp">{{ post.timestamp | ts }}</p>
        {% if post.media_paths %}
            <div class="media-gallery">
                {# GEMINI-TARGET: media-render v2 #}
{% for media_path in post.media_paths %}
  {% set ext = (media_path.rsplit('.', 1)[-1] | lower) if ('.' in media_path) else '' %}
  {% if ext in ['jpg','jpeg','png','gif','webp'] %}
    <img src="{{ url_for('media', path=media_path) }}" alt="Post media" loading="lazy" style="max-width:100%;height:auto;display:block;">
  {% elif ext in ['mp4','mov','webm'] %}
    <video controls preload="metadata" loading="lazy" style="max-width:100%;height:auto;display:block;">
      <source src="{{ url_for('media', path=media_path) }}">
      Your browser does not support the video tag.
    </video>
  {% else %}
    <a href="{{ url_for('media', path=media_path) }}">Download media</a>
  {% endif %}
{% endfor %}
{# GEMINI-END: media-render #}
            </div>
        {% endif %}
        <p class="tags">{% if post.tags %}Tags: {{ post.tags }}{% else %}Tags: None{% endif %}</p>
    </div>
{% endmacro %}

{% macro render_pagination(current_page, total_pages, query, sort_order) %}
    <nav aria-label="Page navigation">
        <ul class="pagination">
            {% if current_page > 1 %}
                <li class="page-item">
                    <a class="page-link" href="?page=1&q={{ query }}&sort_order={{ sort_order }}">First</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?page={{ current_page - 1 }}&q={{ query }}&sort_order={{ sort_order }}">Previous</a>
                </li>
            {% endif %}

            {% for p in range(1, total_pages + 1) %}
                <li class="page-item {% if p == current_page %}active{% endif %}">
                    <a class="page-link" href="?page={{ p }}&q={{ query }}&sort_order={{ sort_order }}">{{ p }}</a>
                </li>
            {% endfor %}

            {% if current_page < total_pages %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ current_page + 1 }}&q={{ query }}&sort_order={{ sort_order }}">Next</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?page={{ total_pages }}&q={{ query }}&sort_order={{ sort_order }}">Last</a>
                </li>
            {% endif %}
        </ul>
    </nav>
{% endmacro %}
