{% extends "base.html" %}
{% from '_macros.html' import render_post_card, render_pagination with context %}

{% block title %}InstaSave - Saved Posts{% endblock %}

{% block head %}
    <link rel="stylesheet" href="{{ url_for('static', path='css/posts.css') }}">
{% endblock %}

{% block content %}
    <h1>Saved Instagram Posts</h1>

    <form method="get" action="/posts" class="mb-4 flex gap-2 items-center">
        <input type="text" name="q" value="{{ request.query_params.get('q', '') }}"
               placeholder="Search tags or captions"
               class="border p-2 w-64 rounded" />
        <label for="sortOrder" class="ml-4">Sort by:</label>
        <select id="sortOrder" name="sort_order" onchange="this.form.submit()">
            <option value="desc" {% if sort_order == "desc" %}selected{% endif %}>Newest First</option>
            <option value="asc" {% if sort_order == "asc" %}selected{% endif %}>Oldest First</option>
        </select>
        <button class="bg-blue-600 text-white px-4 py-2 rounded">Search</button>
    </form>

    {% if posts %}
        <div class="post-grid">
            {% for post in posts %}
                {{ render_post_card(post) }}
            {% endfor %}
        </div>
        {{ render_pagination(current_page, total_pages, query, sort_order) }}
    {% else %}
        <div class="no-posts">
            <p>No posts found.</p>
            <a href="/scrape" class="bg-blue-600 text-white px-4 py-2 rounded">Scrape for new posts</a>
        </div>
    {% endif %}

    <!-- Lightbox HTML -->
    <div class="lightbox-overlay" id="lightboxOverlay">
        <div class="lightbox-content">
            <a href="#" class="lightbox-close" id="lightboxClose">&times;</a>
            <div id="lightboxMedia"></div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script src="{{ url_for('static', path='js/posts.js') }}"></script>
{% endblock %}